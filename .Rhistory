devtools::create("moranajp")
devtools::create("./")
here::dr_here()
devtools::create("D:\matu\work\ToDo\moranajp")
devtools::create("D:\matu\work\ToDo\moranajp")
> devtools::create("D:/Dropbox/ToDo/moranajp/moranajp")
devtools::create("D:/Dropbox/ToDo/moranajp/moranajp")
neko <- c(
"吾輩は猫である。名前はまだ無い。",
"どこで生まれたか頓と見當がつかぬ。何ても暗薄いじめじめした所でニャーゝ泣いて居た事丈は記憶して居る。吾輩はこゝで始めて人間といふものを見た。然もあとで聞くとそれは書生といふ人間で一番獰惡な種族であつたさうだ。此書生といふのは時々我々を捕へて煮て食ふといふ話である。然し其當時は何といふ考もなかつたから別段恐しいとも思はなかつた。但彼の掌に載せられてスーと持ち上げられた時何だかフハフハした感じが有つた許りである。掌の上で少し落ち付いて書生の顏を見たが所謂人間といふものゝ見始であらう。此の時妙なものだと思つた感じが今でも殘つて居る。第一毛を以て裝飾されべき筈の顏がつるゝして丸で藥罐だ。其後猫にも大分逢つたがこんな片輪には一度も出會はした事がない。加之顏の眞中が餘りに突起して居る。そうして其穴の中から時々ぷうゝと烟を吹く。どうも咽せぽくて實に弱つた。是が人間の飮む烟草といふものである事は漸く此頃知つた。",
"此書生の掌の裏でしばらくはよい心持に坐つて居つたが、暫くすると非常な速力で運轉し始めた。書生が動くのか自分丈が動くのか分らないが無暗に眼が廻る。胸が惡くなる。到底助からないと思つて居ると、どさりと音がして眼から火が出た。夫迄は記憶して居るがあとは何の事やらいくら考へ出さうとしても分らない。",
"ふと氣が付いて見ると書生は居ない。澤山居つた兄弟が一疋も見えぬ。肝心の母親さへ姿を隱して仕舞つた。其上今迄の所とは違つて無暗に明るい。眼を明いて居られぬ位だ。果てな何でも容子が可笑いと、のそゝ這ひ出して見ると非常に痛い。吾輩は藁の上から急に笹原の中へ棄てられたのである。"
)
devtools::use_data(neko, neko)
neko
neko <- c(
"吾輩は猫である。名前はまだ無い。",
"どこで生まれたか頓と見當がつかぬ。何ても暗薄いじめじめした所でニャーゝ泣いて居た事丈は記憶して居る。吾輩はこゝで始めて人間といふものを見た。然もあとで聞くとそれは書生といふ人間で一番獰惡な種族であつたさうだ。此書生といふのは時々我々を捕へて煮て食ふといふ話である。然し其當時は何といふ考もなかつたから別段恐しいとも思はなかつた。但彼の掌に載せられてスーと持ち上げられた時何だかフハフハした感じが有つた許りである。掌の上で少し落ち付いて書生の顏を見たが所謂人間といふものゝ見始であらう。此の時妙なものだと思つた感じが今でも殘つて居る。第一毛を以て裝飾されべき筈の顏がつるゝして丸で藥罐だ。其後猫にも大分逢つたがこんな片輪には一度も出會はした事がない。加之顏の眞中が餘りに突起して居る。そうして其穴の中から時々ぷうゝと烟を吹く。どうも咽せぽくて實に弱つた。是が人間の飮む烟草といふものである事は漸く此頃知つた。",
"此書生の掌の裏でしばらくはよい心持に坐つて居つたが、暫くすると非常な速力で運轉し始めた。書生が動くのか自分丈が動くのか分らないが無暗に眼が廻る。胸が惡くなる。到底助からないと思つて居ると、どさりと音がして眼から火が出た。夫迄は記憶して居るがあとは何の事やらいくら考へ出さうとしても分らない。",
"ふと氣が付いて見ると書生は居ない。澤山居つた兄弟が一疋も見えぬ。肝心の母親さへ姿を隱して仕舞つた。其上今迄の所とは違つて無暗に明るい。眼を明いて居られぬ位だ。果てな何でも容子が可笑いと、のそゝ這ひ出して見ると非常に痛い。吾輩は藁の上から急に笹原の中へ棄てられたのである。"
) %>%
tibble::tibble(text=.)
devtools::use_data(neko, neko)
neko
tibble::tibble(text=neko)
neko
neko <- tibble::tibble(text=neko)
neko
devtools::use_data(neko, neko)
devtools::use_data(neko, neko)
devtools::use_data
neko <- c(
"吾輩は猫である。名前はまだ無い。",
"どこで生まれたか頓と見當がつかぬ。何ても暗薄いじめじめした所でニャーゝ泣いて居た事丈は記憶して居る。吾輩はこゝで始めて人間といふものを見た。然もあとで聞くとそれは書生といふ人間で一番獰惡な種族であつたさうだ。此書生といふのは時々我々を捕へて煮て食ふといふ話である。然し其當時は何といふ考もなかつたから別段恐しいとも思はなかつた。但彼の掌に載せられてスーと持ち上げられた時何だかフハフハした感じが有つた許りである。掌の上で少し落ち付いて書生の顏を見たが所謂人間といふものゝ見始であらう。此の時妙なものだと思つた感じが今でも殘つて居る。第一毛を以て裝飾されべき筈の顏がつるゝして丸で藥罐だ。其後猫にも大分逢つたがこんな片輪には一度も出會はした事がない。加之顏の眞中が餘りに突起して居る。そうして其穴の中から時々ぷうゝと烟を吹く。どうも咽せぽくて實に弱つた。是が人間の飮む烟草といふものである事は漸く此頃知つた。",
"此書生の掌の裏でしばらくはよい心持に坐つて居つたが、暫くすると非常な速力で運轉し始めた。書生が動くのか自分丈が動くのか分らないが無暗に眼が廻る。胸が惡くなる。到底助からないと思つて居ると、どさりと音がして眼から火が出た。夫迄は記憶して居るがあとは何の事やらいくら考へ出さうとしても分らない。",
"ふと氣が付いて見ると書生は居ない。澤山居つた兄弟が一疋も見えぬ。肝心の母親さへ姿を隱して仕舞つた。其上今迄の所とは違つて無暗に明るい。眼を明いて居られぬ位だ。果てな何でも容子が可笑いと、のそゝ這ひ出して見ると非常に痛い。吾輩は藁の上から急に笹原の中へ棄てられたのである。"
) %>%
neko <- tibble::tibble(text=neko)
usethis::use_data(neko, neko)
neko
neko %>%
dplyr::mutate(cols=rep(1:2, each=2))
library(magrittr)
neko %>%
dplyr::mutate(cols=rep(1:2, each=2))
add_text_id <- function(
tbl,
text_id="text_id"
){
cnames <- colnames(tbl)
tbl %>%
dplyr::mutate(tmp = dplyr::case_when((.["表層形"]=="EOS" & is.na(.["品詞"])) ~ 1, TRUE~ 0)) %>%
dplyr::mutate(tmp = purrr::accumulate(tmp, magrittr::add)) %>%
dplyr::mutate(tmp = tmp + 1) %>%
magrittr::set_colnames(c(cnames, text_id))
}
neko %>%
dplyr::mutate(cols=rep(1:2, each=2)) %>%
add_text_id()
q()
out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
use_this::use_data(out_cols)
usethis::use_data(out_cols)
neko
neko
tibble::tibble(text=neko[[1]])
library(tidyverse)
neko <- c(
"吾輩は猫である。名前はまだ無い。",
"どこで生まれたか頓と見當がつかぬ。何ても暗薄いじめじめした所でニャーゝ泣いて居た事丈は記憶して居る。吾輩はこゝで始めて人間といふものを見た。然もあとで聞くとそれは書生といふ人間で一番獰惡な種族であつたさうだ。此書生といふのは時々我々を捕へて煮て食ふといふ話である。然し其當時は何といふ考もなかつたから別段恐しいとも思はなかつた。但彼の掌に載せられてスーと持ち上げられた時何だかフハフハした感じが有つた許りである。掌の上で少し落ち付いて書生の顏を見たが所謂人間といふものゝ見始であらう。此の時妙なものだと思つた感じが今でも殘つて居る。第一毛を以て裝飾されべき筈の顏がつるゝして丸で藥罐だ。其後猫にも大分逢つたがこんな片輪には一度も出會はした事がない。加之顏の眞中が餘りに突起して居る。そうして其穴の中から時々ぷうゝと烟を吹く。どうも咽せぽくて實に弱つた。是が人間の飮む烟草といふものである事は漸く此頃知つた。",
"此書生の掌の裏でしばらくはよい心持に坐つて居つたが、暫くすると非常な速力で運轉し始めた。書生が動くのか自分丈が動くのか分らないが無暗に眼が廻る。胸が惡くなる。到底助からないと思つて居ると、どさりと音がして眼から火が出た。夫迄は記憶して居るがあとは何の事やらいくら考へ出さうとしても分らない。",
"ふと氣が付いて見ると書生は居ない。澤山居つた兄弟が一疋も見えぬ。肝心の母親さへ姿を隱して仕舞つた。其上今迄の所とは違つて無暗に明るい。眼を明いて居られぬ位だ。果てな何でも容子が可笑いと、のそゝ這ひ出して見ると非常に痛い。吾輩は藁の上から急に笹原の中へ棄てられたのである。"
) %>%
tibble::tibble(text=.)
neko
tibble::tibble(text=neko[[1]])
tibble::tibble(text=neko[1])
tibble::tibble(text=neko[1,])
neko
mecab <- function(
tbl,          # tbl of input text
bin_dir,      # bin file of mecab
fileEncoding  #
){
# records current working directory
o_wd <- getwd()
on.exit(setwd(o_wd))
setwd(bin_dir)
out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
write.table(tbl, "input.txt", quote=FALSE, col.names=FALSE, row.names=FALSE, fileEncoding=fileEncoding)
cmd <- stringr::str_c("mecab input.txt -o output.txt")
shell(cmd)
tbl <-
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
unlink(c("input.txt", "output.txt"))  # delete temporary file
tbl
}
mecab(neko, bin_dir="d:/pf/mecab/bin", fileEncoding="CP932")
usethis::use_ccby_license()
library(tidyverse)
?select
?pivot_wider
devtools::install_github("matutosi/moranajp", upgrade = c("never"), force = TRUE)
library(tidyverse)
library(magrittr)
library(moranajp)
data(neko)
neko
mecab
mecab_all
library(moranajp)
library(moranajp)
library(moranajp)
mecab
q()
stringi::stri_escape_unicode("ようこそ")
out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
devtools::use_data(out_cols, internal = TRUE)
usethis::use_data(out_cols, internal = TRUE)
tmp
library(tidyverse)
neko <- c(
"吾輩は猫である。名前はまだ無い。",
"どこで生まれたか頓と見當がつかぬ。何ても暗薄いじめじめした所でニャーゝ泣いて居た事丈は記憶して居る。吾輩はこゝで始めて人間といふものを見た。然もあとで聞くとそれは書生といふ人間で一番獰惡な種族であつたさうだ。此書生といふのは時々我々を捕へて煮て食ふといふ話である。然し其當時は何といふ考もなかつたから別段恐しいとも思はなかつた。但彼の掌に載せられてスーと持ち上げられた時何だかフハフハした感じが有つた許りである。掌の上で少し落ち付いて書生の顏を見たが所謂人間といふものゝ見始であらう。此の時妙なものだと思つた感じが今でも殘つて居る。第一毛を以て裝飾されべき筈の顏がつるゝして丸で藥罐だ。其後猫にも大分逢つたがこんな片輪には一度も出會はした事がない。加之顏の眞中が餘りに突起して居る。そうして其穴の中から時々ぷうゝと烟を吹く。どうも咽せぽくて實に弱つた。是が人間の飮む烟草といふものである事は漸く此頃知つた。",
"此書生の掌の裏でしばらくはよい心持に坐つて居つたが、暫くすると非常な速力で運轉し始めた。書生が動くのか自分丈が動くのか分らないが無暗に眼が廻る。胸が惡くなる。到底助からないと思つて居ると、どさりと音がして眼から火が出た。夫迄は記憶して居るがあとは何の事やらいくら考へ出さうとしても分らない。",
"ふと氣が付いて見ると書生は居ない。澤山居つた兄弟が一疋も見えぬ。肝心の母親さへ姿を隱して仕舞つた。其上今迄の所とは違つて無暗に明るい。眼を明いて居られぬ位だ。果てな何でも容子が可笑いと、のそゝ這ひ出して見ると非常に痛い。吾輩は藁の上から急に笹原の中へ棄てられたのである。"
) %>%
tibble::tibble(text=.)
neko
mecab_all <- function(
tbl,
text_col="text",
bin_dir,
fileEncoding="CP932"
){
tbl <- tbl %>% dplyr::mutate(text_id=1:nrow(.))
others <- dplyr::select(tbl, !dplyr::all_of(text_col))
tbl %>%
dplyr::select(dplyr::all_of(text_col)) %>%
mecab(bin_dir, fileEncoding) %>%
add_text_id() %>%
dplyr::left_join(others) %>%
dplyr::slice(-nrow(.))
}
#' テキストに対する形態素解析を一括で実行
#'
#' テキストに対する形態素解析を一括で実行します．
#' 形態素解析にはMeCabを使用します．
#'
#' @param tbl          Tibble or data.frame.
#' @param bin_dir      Text，Directory of mecab.exe.
#' @param fileEncoding Text, Fileencoding in mecab. "EUC", "CP932" (shift_jis) or "UTF-8".
#'
#' @return Tibble.       Output of MeCab.
#'
#' @seealso mecab_all()
#'
#' @examples
#' # not run
#' # data(neko)
#' # bin_dir <- "c:/mecab/bin"  # input your environment
#' # fileEncoding <- "CP932"    # input your environment
#' # mecab(neko, bin_dir=bin_dir, fileEncoding=fileEncoding)
#'
#' @export
mecab <- function(
tbl,          # tbl of input text
bin_dir,      # bin file of mecab
fileEncoding  #
){
# records current working directory
o_wd <- getwd()
on.exit(setwd(o_wd))
setwd(bin_dir)
#   data(out_cols)
#   out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
# write file for morphological analysis # (maybe) can not set file encoding in write_tsv()
utils::write.table(tbl, "input.txt", quote=FALSE, col.names=FALSE, row.names=FALSE, fileEncoding=fileEncoding)
# run command
cmd <- stringr::str_c("mecab input.txt -o output.txt")
shell(cmd)
# read result file
tbl <-
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
#     unlink(c("input.txt", "output.txt"))  # delete temporary file
tbl
}
#' 形態素解析の結果にid列を追加
#'
#' 形態素解析の結果のデータフレームにid列を追加します．
#' mecab_all()の内部関数として使用．
#'
#' @param tbl          Tibble or data.frame.
#  @param text_id      Text. Colnames for id of text.
#'
#' @return Tibble.
#'
#' @export
add_text_id <- function(
tbl,
text_id="text_id"
){
cnames <- colnames(tbl)
tbl %>%
#     dplyr::mutate(tmp = dplyr::case_when((.["表層形"]=="EOS" & is.na(.["品詞"])) ~ 1, TRUE~ 0)) %>%
dplyr::mutate(tmp = dplyr::case_when(
(dplyr::select(., 1)=="EOS" & is.na(dplyr::select(., 2))) ~ 1, TRUE ~ 0)
) %>%
dplyr::mutate(tmp = purrr::accumulate(tmp, magrittr::add)) %>%
dplyr::mutate(tmp = tmp + 1) %>%
magrittr::set_colnames(c(cnames, text_id))
}
neko %>%
mutate(cols=rep(1:2, each=2)) %>%
mecab_all(neko, text_col="text", bin_dir="D:/pf/MeCab/bin", fileEncoding="CP932") %>%
print(n=nrow(.))
neko %>%
mutate(cols=rep(1:2, each=2)) %>%
mecab_all(text_col="text", bin_dir="D:/pf/MeCab/bin", fileEncoding="CP932") %>%
print(n=nrow(.))
#' データフレームの特定の列に対する形態素解析
#'
#' データフレームの特定の列に対して，形態素解析を実行します．
#' 形態素解析にはMeCabを使用します．
#' 形態素解析の対象外の列も出力されます．
#'
#' @param tbl          Tibble or data.frame.
#' @param text_col     Text. Colnames for morphological analysis.
#' @param bin_dir      Text，Directory of mecab.exe.
#' @param fileEncoding Text, Fileencoding in mecab. "EUC", "CP932" (shift_jis) or "UTF-8".
#'
#' @return Tibble.
#'
#' @seealso mecab()
#'
#' @examples
#' # not run
#' # data(neko)
#' # bin_dir <- "c:/mecab/bin"  # input your environment
#' # fileEncoding <- "CP932"    # input your environment
#' # neko %>%
#' #   tibble::tibble(text=., cols=rep(1:2, each=2))
#' # mecab_all(neko, text_col="text", bin_dir=bin_dir, fileEncoding=fileEncoding) %>%
#' #   print(n=nrow(.))
#'
#' @export
mecab_all <- function(
tbl,
text_col="text",
bin_dir,
fileEncoding="CP932"
){
tbl <- tbl %>% dplyr::mutate(text_id=1:nrow(.))
others <- dplyr::select(tbl, !dplyr::all_of(text_col))
tbl %>%
dplyr::select(dplyr::all_of(text_col)) %>%
mecab(bin_dir, fileEncoding) %>%
add_text_id() %>%
dplyr::left_join(others) %>%
dplyr::slice(-nrow(.))
}
#' テキストに対する形態素解析を一括で実行
#'
#' テキストに対する形態素解析を一括で実行します．
#' 形態素解析にはMeCabを使用します．
#'
#' @param tbl          Tibble or data.frame.
#' @param bin_dir      Text，Directory of mecab.exe.
#' @param fileEncoding Text, Fileencoding in mecab. "EUC", "CP932" (shift_jis) or "UTF-8".
#'
#' @return Tibble.       Output of MeCab.
#'
#' @seealso mecab_all()
#'
#' @examples
#' # not run
#' # data(neko)
#' # bin_dir <- "c:/mecab/bin"  # input your environment
#' # fileEncoding <- "CP932"    # input your environment
#' # mecab(neko, bin_dir=bin_dir, fileEncoding=fileEncoding)
#'
#' @export
mecab <- function(
tbl,          # tbl of input text
bin_dir,      # bin file of mecab
fileEncoding  #
){
# records current working directory
o_wd <- getwd()
on.exit(setwd(o_wd))
setwd(bin_dir)
#   data(out_cols)
out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
# write file for morphological analysis # (maybe) can not set file encoding in write_tsv()
utils::write.table(tbl, "input.txt", quote=FALSE, col.names=FALSE, row.names=FALSE, fileEncoding=fileEncoding)
# run command
cmd <- stringr::str_c("mecab input.txt -o output.txt")
shell(cmd)
# read result file
tbl <-
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
#     unlink(c("input.txt", "output.txt"))  # delete temporary file
tbl
}
#' 形態素解析の結果にid列を追加
#'
#' 形態素解析の結果のデータフレームにid列を追加します．
#' mecab_all()の内部関数として使用．
#'
#' @param tbl          Tibble or data.frame.
#  @param text_id      Text. Colnames for id of text.
#'
#' @return Tibble.
#'
#' @export
add_text_id <- function(
tbl,
text_id="text_id"
){
cnames <- colnames(tbl)
tbl %>%
#     dplyr::mutate(tmp = dplyr::case_when((.["表層形"]=="EOS" & is.na(.["品詞"])) ~ 1, TRUE~ 0)) %>%
dplyr::mutate(tmp = dplyr::case_when(
(dplyr::select(., 1)=="EOS" & is.na(dplyr::select(., 2))) ~ 1, TRUE ~ 0)
) %>%
dplyr::mutate(tmp = purrr::accumulate(tmp, magrittr::add)) %>%
dplyr::mutate(tmp = tmp + 1) %>%
magrittr::set_colnames(c(cnames, text_id))
}
res <-
neko %>%
mutate(cols=rep(1:2, each=2)) %>%
mecab_all(text_col="text", bin_dir="D:/pf/MeCab/bin", fileEncoding="CP932") %>%
print(n=nrow(.))
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
print()
readLines("output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
out_cols <- c("表層形", "品詞", "品詞細分類1", "品詞細分類2", "品詞細分類3", "活用型", "活用形", "原形", "読み", "発音")
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.) %>%
tidyr::separate(tmp, sep="\t|,", into=letters[1:10], fill="right", extra="drop") %>%
magrittr::set_colnames(out_cols)
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(tmp=.)
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
~tibble::tibble(tmp=.)
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble(., tmp=.)
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble()
readLines("d:/pf/mecab/bin/output.txt",  encoding="CP932") %>%
tibble::tibble() %>%
magrittr::set_colnames("tmp")
q()
rm(list=ls(all=TRUE)); gc(); gc()
options(encoding="UTF-8")
neko <- "吾輩は猫である。名前はまだ無い。"
neko
usethis::use_data(neko_utf8)
iconv(neko, from="utf-8", to="cp932")
rm(list=ls(all=TRUE)); gc(); gc()
options(encoding="cp932")
neko <- "吾輩は猫である。名前はまだ無い。"
usethis::use_data(neko_sjis)
rm(list=ls(all=TRUE)); gc(); gc()
options(encoding="UTF-8")
neko_utf8 <- "吾輩は猫である。名前はまだ無い。"
usethis::use_data(neko_utf8)
rm(list=ls(all=TRUE)); gc(); gc()
options(encoding="cp932")
neko_sjis <- "吾輩は猫である。名前はまだ無い。"
usethis::use_data(neko_sjis)
library(moranajp)
library(tidyverse)
library(moranajp)
neko
data(neko)
"neko"
neko
neko_utf8
data(neko_utf8)
neko_utf8
data(neko_sjis)
neko_sjis
rm(list=ls(all=TRUE)); gc(); gc()
options(encoding="UTF-8")
neko_utf8 <- "吾輩は猫である。名前はまだ無い。"
neko_sjis <- iconv(neko_utf8, from="utf-8", to="cp932")
usethis::use_data(neko_utf8)
usethis::use_data(neko_sjis)
q()
